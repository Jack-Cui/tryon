# 📤 微信分享功能使用指南

## 功能概述

本项目集成了微信JS-SDK，提供了完整的微信分享功能。用户可以通过点击分享图标，将当前页面分享给微信好友或分享到朋友圈。

## 功能特点

- ✅ 支持分享给微信好友
- ✅ 支持分享到朋友圈
- ✅ 自动检测微信环境
- ✅ 动态加载微信JS-SDK
- ✅ 完整的错误处理
- ✅ 美观的UI界面
- ✅ 分享提示功能

## 快速开始

### 1. 配置微信AppID

在 `src/config/config.tsx` 文件中配置你的微信AppID：

```typescript
export const WECHAT_CONFIG = {
  // 微信应用ID
  APP_ID: 'your_wechat_app_id', // 请替换为实际的微信AppID
  
  // 默认分享配置
  DEFAULT_SHARE: {
    title: 'PADA2024秀款礼服系列',
    desc: '快来体验最新的AI试穿功能！',
    link: window.location.href,
    imgUrl: 'https://example.com/share-image.jpg' // 请替换为实际的分享图片URL
  }
};
```

### 2. 使用分享功能

在页面中，用户可以通过以下方式使用分享功能：

1. **选择界面**：在右侧服装展示区域下方有微信分享图标
2. **视频播放界面**：在右侧服装图标区域下方有微信分享图标
3. **开发环境**：右上角有"测试分享"按钮（仅开发环境显示）

### 3. 分享流程

1. 用户点击分享图标
2. 系统自动初始化微信SDK
3. 配置分享参数（标题、描述、链接、图片）
4. 显示分享提示
5. 用户在微信中点击右上角菜单进行分享

## 核心文件

### 服务层
- `src/services/wechatShareService.ts` - 微信分享服务核心逻辑
- 提供初始化、配置、分享等功能

### 配置层
- `src/config/config.tsx` - 微信分享配置
- 包含AppID和默认分享参数

### 组件层
- `src/pages/Home/index.tsx` - 主页面，包含分享图标和事件处理

## 配置参数说明

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| APP_ID | string | ✅ | 微信应用ID |
| title | string | ✅ | 分享标题 |
| desc | string | ✅ | 分享描述 |
| link | string | ✅ | 分享链接 |
| imgUrl | string | ✅ | 分享图片URL |

## 分享内容

### 默认分享内容
- **标题**: "PADA2024秀款礼服系列 - AI试穿体验"
- **描述**: "快来体验最新的AI试穿功能，感受科技与时尚的完美结合！"
- **链接**: 当前页面URL
- **图片**: 当前选中的服装图片或默认分享图片

### 动态内容
- 分享标题会包含当前房间名称
- 分享图片会使用当前选中的服装图片
- 分享链接为当前页面URL

## 环境要求

### 微信环境
- 必须在微信浏览器中使用
- 需要配置正确的微信AppID
- 需要后端提供微信JS-SDK签名接口

### 开发环境
- 支持在非微信环境中测试
- 开发环境会显示测试分享按钮
- 可以模拟分享流程

## 错误处理

### 常见错误
1. **微信SDK加载失败**: 检查网络连接和CDN地址
2. **微信SDK配置失败**: 检查AppID和签名是否正确
3. **分享配置失败**: 检查分享参数是否有效
4. **非微信环境**: 显示提示信息

### 错误提示
- 控制台会输出详细的错误信息
- 用户界面会显示友好的错误提示
- 支持重试机制

## 注意事项

### 微信限制
- 只能在微信浏览器中使用
- 需要正确的微信AppID和签名
- 分享图片需要是HTTPS链接
- 分享链接需要是HTTPS链接

### 开发建议
- 在开发环境中测试分享逻辑
- 使用真实的微信AppID进行测试
- 确保分享图片和链接可访问
- 测试不同微信版本的兼容性

## 扩展功能

### 自定义分享内容
可以通过修改 `handleWechatShare` 函数来自定义分享内容：

```typescript
await wechatShareService.share({
  title: '自定义标题',
  desc: '自定义描述',
  link: '自定义链接',
  imgUrl: '自定义图片URL'
});
```

### 分享回调
可以监听分享成功和失败的回调：

```typescript
// 在微信分享服务中添加回调支持
wechatShareService.onShareSuccess(() => {
  console.log('分享成功');
});

wechatShareService.onShareFail((error) => {
  console.error('分享失败:', error);
});
```

## 故障排除

### 分享不生效
1. 检查是否在微信环境中
2. 检查AppID是否正确
3. 检查签名是否正确
4. 检查分享参数是否有效

### 图片不显示
1. 确保图片URL是HTTPS链接
2. 确保图片可以正常访问
3. 检查图片格式是否支持

### 链接无法访问
1. 确保链接是HTTPS链接
2. 确保链接可以正常访问
3. 检查域名是否在微信白名单中

### 常见错误及解决方案

#### 1. "updateAppMessageShareData:the permission value is offline verifying"
**原因**: 微信JS-SDK权限验证失败
**解决方案**:
- 检查微信AppID是否正确
- 确保域名已在微信公众平台配置
- 检查签名是否正确
- 尝试使用旧版分享接口

#### 2. "invalid signature"
**原因**: 微信签名验证失败
**解决方案**:
- 检查后端签名生成逻辑
- 确保URL参数正确
- 检查时间戳是否同步

#### 3. "permission denied"
**原因**: 没有分享权限
**解决方案**:
- 检查微信公众平台配置
- 确保已开通分享功能
- 检查用户是否在微信环境中

#### 4. "config:invalid url"
**原因**: 当前页面URL不在白名单中
**解决方案**:
- 在微信公众平台添加域名白名单
- 确保使用HTTPS协议
- 检查URL格式是否正确

### 调试方法

#### 1. 开启调试模式
在微信SDK配置中设置 `debug: true`：
```typescript
window.wx.config({
  debug: true, // 开启调试模式
  // ... 其他配置
});
```

#### 2. 检查API可用性
```typescript
window.wx.checkJsApi({
  jsApiList: ['updateAppMessageShareData'],
  success: (res) => {
    console.log('API检查结果:', res);
  }
});
```

#### 3. 查看控制台错误
在浏览器开发者工具中查看详细的错误信息。

### 备用方案

如果微信分享功能无法正常工作，可以考虑以下备用方案：

1. **手动分享提示**: 显示提示让用户手动点击微信右上角菜单分享
2. **复制链接**: 提供复制链接功能
3. **二维码分享**: 生成页面二维码供用户扫描
4. **短信分享**: 通过短信发送链接

### 最佳实践

1. **错误处理**: 不要因为分享失败而阻止用户使用其他功能
2. **用户友好**: 提供清晰的错误提示和操作指导
3. **降级方案**: 提供多种分享方式作为备用
4. **测试充分**: 在不同设备和微信版本中测试
5. **监控日志**: 记录分享成功率和错误信息

## 更新日志

### v1.0.0
- ✅ 基础微信分享功能
- ✅ 支持分享给好友和朋友圈
- ✅ 自动检测微信环境
- ✅ 完整的错误处理
- ✅ 美观的UI界面 